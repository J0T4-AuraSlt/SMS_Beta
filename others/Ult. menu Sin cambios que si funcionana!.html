menu que si funcionana!

<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Men√∫ Principal SMS</title>
    <link
      rel="icon"
      href="{{ url_for('static', filename='imagen/favicon-vivo.png') }}"
      type="image/x-icon"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/style_menucons.css') }}"
    />

    <script>
      function cargarModulo(url) {
        fetch(url)
          .then((response) => {
            if (!response.ok) {
              throw new Error("La respuesta de la red no era correcta");
            }
            return response.text();
          })
          .then((data) => {
            document.querySelector(".content").innerHTML = data; // Cargar contenido en el √°rea de contenido

            // Registra los eventos para el m√≥dulo cargado
            registrarEventosModulo();
          })
          .catch((error) => {
            console.error("Hubo un problema con la solicitud Fetch:", error);
            document.querySelector(".content").innerHTML =
              "<p>Error al cargar el m√≥dulo</p>";
          });
      }

      function saveCurrentModule(url) {
        sessionStorage.setItem("lastModule", url); // Guardar la URL del m√≥dulo actual
      }

      function registrarEventosModulo() {
        // Para registrar cualquier evento despu√©s de cargar un m√≥dulo
        if (document.getElementById("analyze-button")) {
          // Manejar el evento 'click' del bot√≥n 'Analizar'
          document
            .getElementById("analyze-button")
            .addEventListener("click", function () {
              const product = document.getElementById("product").value;
              const startDate = document.getElementById("start-date").value;
              const endDate = document.getElementById("end-date").value;

              if (!product || !startDate || !endDate) {
                alert("Por favor, complete todos los campos del formulario.");
                return;
              }

              const productData = {
                peak: 150,
                average: 80,
                min: 20,
                sales: [20, 50, 70, 100, 150, 90, 60],
              };

              const generalSalesData = {
                peak: 200,
                average: 120,
                min: 30,
                sales: [30, 60, 90, 120, 200, 150, 100],
              };

              // Actualizar resultados del producto seleccionado
              document.getElementById("product-peak").innerText =
                productData.peak;
              document.getElementById("product-average").innerText =
                productData.average;
              document.getElementById("product-min").innerText =
                productData.min;

              // Actualizar resultados de ventas generales
              document.getElementById("general-peak").innerText =
                generalSalesData.peak;
              document.getElementById("general-average").innerText =
                generalSalesData.average;
              document.getElementById("general-min").innerText =
                generalSalesData.min;

              const ctx = document
                .getElementById("sales-chart")
                .getContext("2d");

              if (window.salesChart) {
                window.salesChart.destroy();
              }

              window.salesChart = new Chart(ctx, {
                type: "line",
                data: {
                  labels: [
                    "Semana 1",
                    "Semana 2",
                    "Semana 3",
                    "Semana 4",
                    "Semana 5",
                    "Semana 6",
                    "Semana 7",
                  ],
                  datasets: [
                    {
                      label: "Producto Seleccionado",
                      data: productData.sales,
                      borderColor: "rgba(52, 152, 219, 1)",
                      backgroundColor: "rgba(52, 152, 219, 0.2)",
                      fill: true,
                    },
                    {
                      label: "Ventas Generales",
                      data: generalSalesData.sales,
                      borderColor: "rgba(231, 76, 60, 1)",
                      backgroundColor: "rgba(231, 76, 60, 0.2)",
                      fill: true,
                    },
                  ],
                },
                options: {
                  responsive: true,
                  plugins: {
                    legend: {
                      position: "top",
                    },
                    title: {
                      display: true,
                      text: "Comparaci√≥n de Ventas",
                    },
                  },
                },
              });
            });
        }
      }

      document.addEventListener("DOMContentLoaded", function () {
        const themeToggle = document.getElementById("theme-toggle");

        const currentTheme = localStorage.getItem("theme") || "light";
        document.documentElement.setAttribute("data-theme", currentTheme);

        themeToggle.textContent =
          currentTheme === "dark" ? "Modo Claro" : "Modo Oscuro";

        themeToggle.addEventListener("click", function () {
          let theme = document.documentElement.getAttribute("data-theme");

          if (theme === "light") {
            document.documentElement.setAttribute("data-theme", "dark");
            localStorage.setItem("theme", "dark");
            themeToggle.textContent = "Modo Claro";
          } else {
            document.documentElement.setAttribute("data-theme", "light");
            localStorage.setItem("theme", "light");
            themeToggle.textContent = "Modo Oscuro";
          }
        });

        const links = document.querySelectorAll(".navbar > ul > li > a");
        const submenuLinks = document.querySelectorAll(".submenu a");

        links.forEach((link) => {
          link.addEventListener("click", function (e) {
            e.preventDefault();

            const submenu = this.nextElementSibling;

            if (submenu) {
              document.querySelectorAll(".submenu").forEach((sm) => {
                if (sm !== submenu) {
                  sm.style.display = "none";
                }
              });

              submenu.style.display =
                submenu.style.display === "block" ? "none" : "block";
            } else {
              document
                .querySelectorAll(".submenu")
                .forEach((sm) => (sm.style.display = "none"));
            }
          });
        });

        submenuLinks.forEach((submenuLink) => {
          submenuLink.addEventListener("click", function (e) {
            e.preventDefault();
            const url = this.getAttribute("href");

            if (url) {
              cargarModulo(url);
              saveCurrentModule(url);
            }
          });
        });

        // Registro inicial de eventos para los m√≥dulos
        registrarEventosModulo();
      });
    </script>
  </head>

  <body>
    <div class="info-bar">
      <img
        src="{{ url_for('static', filename='imagen/logo-clt.png') }}"
        alt="Logo de la Empresa"
        class="logotwo"
      />
      <span> üë§ {{ raz_social }}</span>
      <span> üßë‚Äçüíª {{ nom_usr|upper }}</span>
      <span> üìÖ {{ fecha_hora }}</span>
      <div class="volver-home">
        <a href="{{ url_for('menu') }}">üè† Home</a>
        <!-- Enlace a tu Home -->
      </div>

      <!-- Bot√≥n para alternar entre los temas -->
      <button id="theme-toggle">Cambiar Tema</button>

      <div class="cerrar-sesion">
        <a href="{{ url_for('index') }}">Cerrar Sesi√≥n</a>
      </div>
    </div>

    <div
      class="main-container"
      style="display: flex; height: calc(100vh - 50px)"
    >
      <nav class="navbar" style="width: 250px; background-color: #82b3ef">
        <ul>
          {% if menu %} {% for item in menu %}
          <li>
            <a href="#">{{ item['descripcion'] }}</a>
            {% if item['hijos'] %}
            <ul class="submenu" style="display: none">
              {% for child in item['hijos'] %}
              <li>
                <a
                  href="{{ url_for('load_module', module_name=child['path']) }}"
                  >{{ child['descripcion'] }}</a
                >
              </li>
              {% endfor %}
            </ul>
            {% endif %}
          </li>
          {% endfor %} {% else %}
          <li>No se encontraron elementos en el men√∫.</li>
          {% endif %}
        </ul>
      </nav>

      <div class="content" style="flex-grow: 2; padding: 20px">
        <h2>Bienvenido</h2>
        <p>
          Hola <strong>{{ nom_usr }}</strong>, tu perfil es:
          <strong>{{ dsc|default('Sin Perfil')|upper }}</strong>.
        </p>
        <p>
          Por favor selecciona un m√≥dulo del men√∫ para visualizar su contenido.
        </p>

        <p><strong>Tienes acceso a:</strong></p>
        {% if menu %}
        <ul>
          {% for item in menu %}
          <li><strong>{{ item['descripcion'] }}</strong></li>
          {% if item['hijos'] %}
          <ul>
            {% for child in item['hijos'] %}
            <li>{{ child['descripcion'] }}</li>
            {% endfor %}
          </ul>
          {% endif %} {% endfor %}
        </ul>
        {% else %}
        <strong>No tienes acceso a ning√∫n m√≥dulo.</strong>
        {% endif %}
      </div>
    </div>
  </body>
</html>
